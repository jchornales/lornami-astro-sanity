---
import type { SanityDocument } from "@sanity/client";
import "@styles/Highlights.css";
import { Image } from "astro:assets";
import { useLoadQuery } from "@/sanity/lib/useLoadQuery";
import { useUrlForImage } from "@/sanity/lib/useUrlForImage";
import ChevronDown from "@/lib/icons/ChevronDown.astro";

const { data: posts } = await useLoadQuery<SanityDocument[]>({
  query: `*[_type == "post"][0..15] | order(publishedAt desc)`,
});
---

<section class="highlights-section section">
  <div class="highlight-wrapper max-h-screen">
    <p class="section-sub-title">
      <q class="quotes">
        If you don&#39;t think photos are important, wait until they&#39;re all
        you have left.
      </q>
      <span class="author"> &#45; Missy Mwac </span>
    </p>

    <div class="highlights-gallery">
      {
        posts.map((post) => (
          <a href={`post/${post.slug.current}`} class="highlights-gallery-item">
            <Image
              src={useUrlForImage(post.mainImage).url()}
              alt={post.title}
              class="highlights-gallery-image"
              inferSize
            />
          </a>
        ))
      }
    </div>
    <div class="highlights-see-more">
      <button class="group flex gap-2" data-button="see-more">
        <ChevronDown
          className="size-10 stroke-black group-hover:stroke-primary"
        />
      </button>
    </div>
  </div>
</section>

<script>
  const moreButton = document.querySelector("[data-button='see-more']");
  const galleryWrapper = document.querySelector(".highlight-wrapper");
  const seeMoreWrapper = document.querySelector(".highlights-see-more");

  moreButton?.addEventListener("click", () => {
    galleryWrapper?.classList.toggle("max-h-screen");
    seeMoreWrapper?.classList.toggle("invisible");
  });
</script>
